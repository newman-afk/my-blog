---
title: useState
date: '2023-06-25'
tags: ['react', 'useState', 'hooks']
draft: false
summary: useState is a React Hook that lets you add a state variable to your component.
---

`useState` is a React Hook that lets you add a state variable to your component.

```jsx
const [state, setState] = useState(initialState)
```

[å®˜æ–¹æ–‡æ¡£é“¾æŽ¥](https://react.dev/reference/react/useState#usestate)

# Basic usage

## Create a state

```jsx
const [count, setCount] = useState(0) //number
const [text, setText] = useState('hello') //string
const [liked, setLiked] = useState(true) //boolean
const [person, setPerson] = useState({
  name: 'Niki de Saint Phalle',
  artwork: {
    title: 'Blue Nana',
    city: 'Hamburg',
    image: 'https://i.imgur.com/Sd1AgUOm.jpg',
  },
}) //object
const [todos, setTodos] = useState([
  { id: 0, title: 'Buy milk', done: true },
  { id: 1, title: 'Eat tacos', done: false },
  { id: 2, title: 'Brew tea', done: false },
]) //array
const [todos, setTodos] = useState(createInitialTodos) //function
```

### Tips

initialState ä¸º function çš„æ—¶å€™ï¼Œä¸è¦è°ƒç”¨è¯¥ functionï¼Œä¹Ÿå°±æ˜¯ä¸è¦å†™æˆ `const [todos, setTodos] = useState(createInitialTodos())`, è¿™æ ·åœ¨æ¯ä¸€æ¬¡ render çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨è¯¥ functionï¼Œä»Žè€Œé€ æˆæ€§èƒ½æŸè€—ã€‚[å®˜æ–¹è§£é‡Š](https://react.dev/reference/react/useState#avoiding-recreating-the-initial-state)

## Updating state

### Basic conceptsï¼š

- state ä¸èƒ½ mutateï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ä¿®æ”¹å…¶æœ¬èº«
- setState()å¹¶ä¸ç«‹å³ç”Ÿæ•ˆï¼Œè€Œæ˜¯åœ¨æ‰§è¡Œå®Œæ‰€æœ‰ function ä¹‹åŽåˆ¤å®šæœ‰å˜åŠ¨æ–¹æ‰ rerender

### Examples

```jsx
const [example, setExample] = useState(initialState)

example = something // Never do this
```

```jsx
setTodos((prevTodos) => {
  // ðŸš© Mistake: mutating state
  prevTodos.push(createTodo())
})

setTodos((prevTodos) => {
  // âœ… Correct: replacing with new state
  return [...prevTodos, createTodo()]
})
```

[å®˜æ–¹è§£é‡Š â¬†](https://react.dev/reference/react/useState#my-initializer-or-updater-function-runs-twice)

```jsx
// é”™è¯¯æ¡ˆä¾‹
const [age, setAge] = useState(42)

setAge(age + 1) //43
setAge(age + 1) //43
```

å¦‚æžœéœ€è¦é‡å¤æ‰§è¡Œç±»ä¼¼çš„ä»£ç ï¼Œä½¿ç”¨åŒ¿åå‡½æ•°ç‰ˆæœ¬

```jsx
// æ­£ç¡®å§¿åŠ¿
const [age, setAge] = useState(42)

setAge((prevAge) => prevAge + 1) //43
setAge((prevAge) => prevAge + 1) //44
```

åœ¨å®žé™…ä½¿ç”¨ä¸­ï¼ŒinitialState ç»å¸¸æ˜¯`array`ã€`object`æˆ–ç›¸å…³çš„åµŒå¥—ï¼Œåœ¨æ­¤ç±»æƒ…å†µä¸‹ï¼Œæ–°çš„æ•°æ®é€šå¸¸éƒ½æ˜¯ç”±ä¹‹å‰çš„æ•°æ®ä¿®æ”¹è€Œæ¥ï¼Œä¾‹å¦‚`array push`,ä½†æ˜¯ State åˆä¸èƒ½ç›´æŽ¥ä¿®æ”¹ï¼Œæˆ–è€…è¯´ä¿®æ”¹æ— æ•ˆï¼Œæ›´æ–°å¹¶ä¸ä¼šè¢«æ‰§è¡Œï¼Œé‚£ä¹ˆæ€Žä¹ˆåŠžå‘¢ï¼Ÿ

**å¤åˆ¶**, simple af, ä¹Ÿæ˜¯å› æ­¤åœ¨å®˜æ–¹æ–‡æ¡£ä¸­å¯ä»¥çœ‹åˆ°å¯¹äºŽ array çš„å¢žåˆ ä½¿ç”¨`spread operator`ä¹Ÿå³`...`, ç±»ä¼¼`setPosts((oldPosts)=>[...oldPosts, newPost])`çš„åšæ³•æ˜¯å¯è¡Œçš„ï¼Œå› ä¸º`...`åˆ›å»ºäº†ä¸€ä»½åŽŸå§‹æ•°æ®çš„å¤åˆ¶ï¼ˆæ·±å¤åˆ¶ï¼‰ã€‚

è¿™é‡Œè¦æåˆ°æ·±å¤åˆ¶ä¸Žæµ…å¤åˆ¶çš„åŒºåˆ«ï¼Œå¯¹äºŽ numberã€stringã€boolean è€Œè¨€ï¼Œä½¿ç”¨ç­‰å·=å³å¯èŽ·å–å…¶æ·±å¤åˆ¶ï¼Œä¹Ÿå³åˆ›å»ºä¸¤ä»½é™¤äº†å†…å®¹ä¸€è‡´å¤–å®Œå…¨æ— å…³çš„æ•°æ®ï¼Œè€Œ array ä¸Ž object åˆ™ä¸åŒï¼Œarray åä¸Ž object åæœ¬è´¨ä¸ºæŒ‡é’ˆï¼Œ=åªèƒ½èŽ·å–æŒ‡å‘åŽŸå§‹æ•°æ®çš„æŒ‡é’ˆï¼Œæœ¬è´¨æ˜¯åŒä¸€ä»½æ•°æ®ï¼Œå› æ­¤éœ€è¦é¢å¤–çš„æ“ä½œã€‚

`...`å¯ä»¥å¤„ç†ç»å¤§å¤šæ•°éœ€è¦æ·±å¤åˆ¶çš„æƒ…å†µï¼ŒåŒ…æ‹¬åµŒå¥—ç±»åž‹ï¼Œä¾‹å¦‚

```jsx
setPerson({
  ...person,
  artwork: {
    ...person.artwork,
    title: e.target.value,
  },
})
```

ä½†æœ‰æ—¶éœ€è¦å¯¹åŽŸå§‹æ•°æ®è¿›è¡Œåˆ é€‰æ‰¾åˆ°éœ€è¦ä¿®æ”¹çš„é‚£ä¸€ä»½å†…å®¹ï¼Œè¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ä¸Šé¢çš„åšæ³•æ˜¯åŠžä¸åˆ°çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ç±»ä¼¼`const newDate = JSON.parse(JSON.stringfy(oldData))`çš„åŠžæ³•æ¥èŽ·å–å½»åº•çš„æ·±å¤åˆ¶ã€‚

#### æ•°æ®ä¸º function

You canâ€™t put a function into state like this:

```jsx
const [fn, setFn] = useState(someFunction)

function handleClick() {
  setFn(someOtherFunction)
}
```

Because youâ€™re passing a function, React assumes that `someFunction` is an initializer function, and that `someOtherFunction` is an updater function, so it tries to call them and store the result. To actually store a function, you have to put `() =>` before them in both cases. Then React will store the functions you pass.

```jsx
const [fn, setFn] = useState(() => someFunction)

function handleClick() {
  setFn(() => someOtherFunction)
}
```
